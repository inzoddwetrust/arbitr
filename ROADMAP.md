# KAD Parser ‚Äî Roadmap

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

–ü–∞—Ä—Å–µ—Ä –ö–∞—Ä—Ç–æ—Ç–µ–∫–∏ –∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã—Ö –¥–µ–ª (kad.arbitr.ru) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—É–¥–µ–±–Ω—ã—Ö –¥–µ–ª–∞—Ö –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

---

## Phase 0: Proof of Concept ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

**–¶–µ–ª—å:** –î–æ–∫–∞–∑–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- [x] –û–±—Ö–æ–¥ WASM –∞–Ω—Ç–∏–±–æ—Ç–∞ (Firefox)
- [x] –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –¥–µ–ª–∞
- [x] –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- [x] –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–µ–ª–∞
- [x] –°–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF —á–µ—Ä–µ–∑ response interceptor

**–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:** `poc_crawler.py`, `PHASE0_REPORT.md`

---

## Phase 1: Core Architecture

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞

### 1.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
kad_parser/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ browser/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manager.py      # Browser lifecycle management
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ interceptors.py # Response interceptors
‚îÇ   ‚îú‚îÄ‚îÄ parsers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search.py       # Search page parser
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ card.py         # Case card parser
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ documents.py    # Documents tab parser
‚îÇ   ‚îú‚îÄ‚îÄ downloaders/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pdf.py          # PDF download logic
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ case.py         # Case data models
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ document.py     # Document models
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ logging.py      # Logging setup
‚îÇ       ‚îî‚îÄ‚îÄ helpers.py      # Utility functions
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_parsers.py
‚îÇ   ‚îî‚îÄ‚îÄ fixtures/           # HTML fixtures for tests
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ settings.py         # Configuration
‚îú‚îÄ‚îÄ pyproject.toml
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ .env.example
```

### 1.2 –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (Pydantic)

```python
class CaseInstance(BaseModel):
    court_code: str
    instance_id: str
    instance_type: str
    reg_date: date
    case_number: str
    court_name: str
    decision_pdf: Optional[HttpUrl]
    decision_text: Optional[str]

class Case(BaseModel):
    case_number: str
    guid: str
    status: str
    plaintiff: Optional[str]
    defendant: Optional[str]
    court: str
    judge: Optional[str]
    instances: list[CaseInstance]
    documents: list[Document]

class Document(BaseModel):
    doc_id: str
    filename: str
    doc_type: str
    date: date
    url: HttpUrl
    local_path: Optional[Path]
```

### 1.3 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
class Settings(BaseSettings):
    # Browser
    headless: bool = True
    browser_timeout: int = 30000
    
    # Downloads
    download_dir: Path = Path("./downloads")
    skip_existing: bool = True
    
    # Rate limiting
    request_delay: float = 1.0
    max_retries: int = 3
    
    # Logging
    log_level: str = "INFO"
    log_file: Optional[Path] = None
```

### 1.4 –ó–∞–¥–∞—á–∏

- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∫–æ–¥ –∏–∑ PoC –≤ –º–æ–¥—É–ª–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å Pydantic –º–æ–¥–µ–ª–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å pyproject.toml
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å type hints –≤–µ–∑–¥–µ

---

## Phase 2: Extended Parsing

**–¶–µ–ª—å:** –†–∞—Å—à–∏—Ä–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞

### 2.1 –í–∫–ª–∞–¥–∫–∞ "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–µ –¥–µ–ª–æ" ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:** –í –∫–∞—Ä—Ç–æ—á–∫–µ –¥–µ–ª–∞ —Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è (1-3 —à—Ç). –í "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–º –¥–µ–ª–µ" ‚Äî –ø–æ–ª–Ω–æ–µ –¥–æ—Å—å–µ: 10-100+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

–°–æ–¥–µ—Ä–∂–∏—Ç:
- –ò—Å–∫–æ–≤—ã–µ –∑–∞—è–≤–ª–µ–Ω–∏—è
- –û—Ç–∑—ã–≤—ã –Ω–∞ –∏—Å–∫
- –•–æ–¥–∞—Ç–∞–π—Å—Ç–≤–∞
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (–≤—Å–µ, –Ω–µ —Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥–æ–≤—ã–µ)
- –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –∑–∞—Å–µ–¥–∞–Ω–∏–π
- –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- –ñ–∞–ª–æ–±—ã
- –†–µ—à–µ–Ω–∏—è/–ø–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

**–ó–∞–¥–∞—á–∏:**
- [ ] –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–∫–ª–∞–¥–∫–∏ (–∫–ª–∏–∫ –Ω–∞ —Ç–∞–±, AJAX?)
- [ ] –°–ø–∞—Ä—Å–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–∞—Å—Å–æ–≤–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —Ç–∏–ø—É –¥–æ–∫—É–º–µ–Ω—Ç–∞
- [ ] –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è (—Ç–µ –∂–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —á—Ç–æ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ)

### 2.2 –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫

–¢–µ–∫—É—â–∏–π PoC –∏—â–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ –Ω–æ–º–µ—Ä—É –¥–µ–ª–∞. –î–æ–±–∞–≤–∏—Ç—å:
- [ ] –ü–æ–∏—Å–∫ –ø–æ —É—á–∞—Å—Ç–Ω–∏–∫—É (–ò–ù–ù, –û–ì–†–ù, –Ω–∞–∑–≤–∞–Ω–∏–µ)
- [ ] –ü–æ–∏—Å–∫ –ø–æ —Å—É–¥—É
- [ ] –ü–æ–∏—Å–∫ –ø–æ –¥–∞—Ç–µ
- [ ] –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–ø–æ—Ä–∞
- [ ] –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫

### 2.3 –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è (–µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ > 25)
- [ ] –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–µ–∫

---

## Phase 3: Storage & Export

**–¶–µ–ª—å:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

### 3.1 –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

```
storage/
‚îú‚îÄ‚îÄ cases/
‚îÇ   ‚îî‚îÄ‚îÄ {case_number}/
‚îÇ       ‚îú‚îÄ‚îÄ case.json       # Metadata
‚îÇ       ‚îî‚îÄ‚îÄ documents/
‚îÇ           ‚îú‚îÄ‚îÄ doc1.pdf
‚îÇ           ‚îî‚îÄ‚îÄ doc2.pdf
‚îî‚îÄ‚îÄ index.json              # Quick lookup index
```

### 3.2 –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [ ] SQLite –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤
- [ ] PostgreSQL –¥–ª—è production
- [ ] –ú–æ–¥–µ–ª–∏ SQLAlchemy / Tortoise ORM

### 3.3 –≠–∫—Å–ø–æ—Ä—Ç

- [ ] JSON
- [ ] CSV
- [ ] Excel (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## Phase 4: Reliability & Performance

**–¶–µ–ª—å:** –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### 4.1 Error Handling

- [ ] Retry logic —Å exponential backoff
- [ ] Graceful degradation (–µ—Å–ª–∏ —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
- [ ] –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- [ ] –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

### 4.2 Rate Limiting

- [ ] –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- [ ] –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π rate limiting (–∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö)
- [ ] Respect robots.txt (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

### 4.3 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- [ ] Connection pooling –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
- [ ] –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ —Å–ø–∞—Ä—Å–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã)

### 4.4 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- [ ] –ú–µ—Ç—Ä–∏–∫–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –æ—à–∏–±–æ–∫, –≤—Ä–µ–º–µ–Ω–∏)
- [ ] Health checks
- [ ] Prometheus metrics (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## Phase 5: CLI & API

**–¶–µ–ª—å:** –£–¥–æ–±–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 5.1 CLI (Click/Typer)

```bash
# –ü–æ–∏—Å–∫ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –¥–µ–ª–∞
kad-parser download –ê40-57726/2024

# –ü–æ–∏—Å–∫ –ø–æ —É—á–∞—Å—Ç–Ω–∏–∫—É
kad-parser search --inn 7707083893 --download

# –ú–∞—Å—Å–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –∏–∑ —Ñ–∞–π–ª–∞
kad-parser batch cases.txt --output ./results

# –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
kad-parser export ./results --format csv
```

### 5.2 Python API

```python
from kad_parser import KadClient

async with KadClient() as client:
    # –ü–æ–∏—Å–∫ –¥–µ–ª–∞
    case = await client.get_case("–ê40-57726/2024")
    
    # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    await client.download_documents(case, "./downloads")
    
    # –ü–æ–∏—Å–∫ –ø–æ –ò–ù–ù
    cases = await client.search(inn="7707083893")
```

---

## Phase 6: Production Ready (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–¶–µ–ª—å:** –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### 6.1 Docker

```dockerfile
FROM python:3.10-slim
RUN playwright install firefox
# ...
```

### 6.2 CI/CD

- [ ] GitHub Actions –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–ª–∏–∑
- [ ] Docker image build

### 6.3 –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [ ] README —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- [ ] API documentation (Sphinx/MkDocs)
- [ ] Contributing guide

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

| –§–∞–∑–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è |
|------|-----------|-----------|-------|
| Phase 1 | üî¥ High | Medium | 2-3 –¥–Ω—è |
| Phase 2 | üî¥ High | Medium | 2-3 –¥–Ω—è |
| Phase 3 | üü° Medium | Low | 1-2 –¥–Ω—è |
| Phase 4 | üü° Medium | High | 3-4 –¥–Ω—è |
| Phase 5 | üü¢ Low | Medium | 2-3 –¥–Ω—è |
| Phase 6 | üü¢ Low | Medium | 2-3 –¥–Ω—è |

---

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|-----------|
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ WASM –∑–∞—â–∏—Ç—ã | –°—Ä–µ–¥–Ω—è—è | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –±—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
| Rate limiting / –±–∞–Ω IP | –í—ã—Å–æ–∫–∞—è | –ü—Ä–æ–∫—Å–∏, –∑–∞–¥–µ—Ä–∂–∫–∏, fingerprint rotation |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã | –°—Ä–µ–¥–Ω—è—è | –¢–µ—Å—Ç—ã –Ω–∞ fixtures, –∞–ª–µ—Ä—Ç—ã |
| –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ headless | –ù–∏–∑–∫–∞—è | –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º Firefox |

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|------------|
| –Ø–∑—ã–∫ | Python 3.10+ |
| –ë—Ä–∞—É–∑–µ—Ä | Playwright + Firefox |
| –ú–æ–¥–µ–ª–∏ | Pydantic v2 |
| CLI | Typer |
| –¢–µ—Å—Ç—ã | pytest + pytest-asyncio |
| –õ–∏–Ω—Ç–µ—Ä | ruff |
| –§–æ—Ä–º–∞—Ç—Ç–µ—Ä | black |
| Type checker | mypy |
